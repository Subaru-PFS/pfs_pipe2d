# To run generateCommands.py with this spec file,
# you have to set environment variable $DRP_PFS_DATA_DIR,
# in which initial detectorMap files reside.

#
# initial detectorMap
#
# The files are to be found in dirName, taken to be relative to --dataDir if
# not an absolute path
#
init:
  dirName: "$DRP_PFS_DATA_DIR/detectorMap"
  arms: [b1, r1, n1, m1]
  detectorMapFmt: "detectorMap-sim-{arm}.fits"

#
# Blocks of data which are used together to update the calibrations
#
calibBlock:
  -
    name: calibs_for_brn
    # Do not generate biases or darks for n
    bias:
      id: ["field=BIAS", "arm=b^r"]
      config:
        - "isr.doCrosstalk=False"  # No crosstalk in simulated data
        - "isr.doIPC=False"  # No IPC in simulated data
    dark:
      id: ["field=DARK", "arm=b^r^n"]
      config:
        - "isr.doCrosstalk=False"  # No crosstalk in simulated data
        - "isr.doIPC=False"  # No IPC in simulated data
    flat:
      id: ["field=FLAT", "arm=b^r^n"]
      config:
        - "isr.doCrosstalk=False"  # No crosstalk in simulated data
        - "isr.doIPC=False"  # No IPC in simulated data
    fiberProfiles:
      id: ["visit=35^37", "arm=b^r^n"]
      normId: ["field=FLAT", "arm=b^r^n", "dither=0"]
      config:
        - "reduceExposure.isr.doCrosstalk=False"  # No crosstalk in simulated data
        - "reduceExposure.isr.doIPC=False"  # No IPC in simulated data
        - "profiles.profileSwath=2000"  # Not much variation
  -
    name: calibs_for_m
    fiberProfiles:
      id: ["visit=36^38", "arm=m"]
      normId: ["field=FLAT", "arm=m", "dither=0"]
      config:
        - "reduceExposure.isr.doCrosstalk=False"  # No crosstalk in simulated data
        - "reduceExposure.isr.doIPC=False"  # No IPC in simulated data
        - "profiles.profileSwath=2000"  # Not much variation
  -
    name: arc_brn
    detectorMap:
      id: ["visit=39..45:2", "arm=b^r^n"]
      config:
        - "fitDetectorMap.doSlitOffsets=True"
        - "fitDetectorMap.minSignalToNoise=20"
        - "reduceExposure.isr.doCrosstalk=False"  # No crosstalk in simulated data
        - "reduceExposure.isr.doIPC=False"  # No IPC in simulated data
  -
    name: arc_m
    detectorMap:
      id: ["visit=40..46:2", "arm=m"]
      config:
        - "fitDetectorMap.doSlitOffsets=True"
        - "fitDetectorMap.minSignalToNoise=20"
        - "reduceExposure.isr.doCrosstalk=False"  # No crosstalk in simulated data
        - "reduceExposure.isr.doIPC=False"  # No IPC in simulated data

#
# Blocks of science pipelines
#
scienceBlock:
  -
    name: pipeline_on_brn
    id: ["visit=47^48^49^53^54^57"]
    policy:
      reduceExposure:
        config:
          - "isr.doCrosstalk=False"  # No crosstalk in simulated data
          - "isr.doIPC=False"  # No IPC in simulated data
          - "repair.interp.modelPsf.defaultFwhm=1.5"
          - "repair.cosmicray.cond3_fac=10"
  -
    name: pipeline_on_bmn
    id: ["visit=50^51^52^55^56^58"]
    policy:
      reduceExposure:
        config:
          - "isr.doCrosstalk=False"  # No crosstalk in simulated data
          - "isr.doIPC=False"  # No IPC in simulated data
          - "repair.interp.modelPsf.defaultFwhm=1.5"
          - "repair.cosmicray.cond3_fac=10"
