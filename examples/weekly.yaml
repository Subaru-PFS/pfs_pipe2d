# To run generateCommands.py with this spec file,
# you have to set environment variable $DRP_PFS_DATA_DIR,
# in which initial detectorMap files reside.

#
# initial detectorMap
#
# The files are to be found in dirName, taken to be relative to --dataDir if
# not an absolute path
#
init:
  dirName: "$DRP_PFS_DATA_DIR/detectorMap"
  arms: [b1, r1, n1, m1]
  detectorMapFmt: "detectorMap-sim-{arm}.fits"

#
# Blocks of data which are used together to update the calibrations
#
calibBlock:
  -
    name: calibs_for_br
    bias:
      id: ["field=BIAS", "arm=b^r"]
    dark:
      id: ["field=DARK", "arm=b^r"]
    flat:
      id: ["field=FLAT", "arm=b^r"]
    fiberProfiles:
      group:
        -
          id: ["visit=35", "arm=b^r"]
        -
          id: ["visit=37", "arm=b^r"]
  -
    name: calibs_for_n
    fiberProfiles:
      group:
        -
          id: ["visit=35", "arm=n"]
          config:
          - "isr.doBias=False"
          - "isr.doDark=False"
          - "isr.doFlat=False"
        -
          id: ["visit=37", "arm=n"]
          config:
          - "isr.doBias=False"
          - "isr.doDark=False"
          - "isr.doFlat=False"
  -
    name: calibs_for_m
    fiberProfiles:
      group:
        -
          id: ["visit=36", "arm=m"]
        -
          id: ["visit=38", "arm=m"]
  -
    name: arc_br
    detectorMap:
      id: ["visit=39..45:2", "arm=b^r"]
      config:
        - "fitDetectorMap.doSlitOffsets=True"
        - "reduceExposure.readLineList.exclusionRadius=0.3"
        - "fitDetectorMap.minSignalToNoise=20"
  -
    name: arc_n
    detectorMap:
      id: ["visit=39..45:2", "arm=n"]
      config:
        - "fitDetectorMap.doSlitOffsets=True"
        - "reduceExposure.readLineList.exclusionRadius=0.3"
        - "fitDetectorMap.minSignalToNoise=20"
        - "reduceExposure.isr.doBias=False"
        - "reduceExposure.isr.doDark=False"
        - "reduceExposure.isr.doFlat=False"
  -
    name: arc_m
    detectorMap:
      id: ["visit=40..46:2", "arm=m"]
      config:
        - "fitDetectorMap.doSlitOffsets=True"
        - "reduceExposure.readLineList.exclusionRadius=0.3"
        - "fitDetectorMap.minSignalToNoise=20"

#
# Blocks of science pipelines
#
scienceBlock:
  -
    name: pipeline_on_brn
    id: ["visit=47^48^49^53^54^57", "arm=b^r"]
    id: ["visit=47^48^49^53^54^57", "arm=n"]
    policy:
        reduceExposure:
            config: ["isr.doBias=False", "isr.doDark=False", "isr.doFlat=False"]
  -
    name: pipeline_on_bmn
    id: ["visit=50^51^52^55^56^58", "arm=b^m"]
    id: ["visit=50^51^52^55^56^58", "arm=n"]
    policy:
        reduceExposure:
            config: ["isr.doBias=False", "isr.doDark=False", "isr.doFlat=False"]
